<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gen‚Äôs Matcha üçµ‚ú®</title>
  <!-- Playful, casual fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#fffaf6;
      --card:#fff;
      --ink:#2f2a2a;
      --muted:#7c6f6a;
      --pastel-1:#b7e4c7;
      --pastel-2:#ffd6e7;
      --pastel-3:#ffef9f;
      --pastel-4:#cde4ff;
      --accent:#7cc5b3;
      --shadow: 0 8px 24px rgb(0 0 0 / 7%);
      --radius:20px;
    }
    body{
      margin:0; background:var(--bg); color:var(--ink);
      font:16px/1.5 "Fredoka","Comic Neue", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      overflow-x:hidden;
    }
    .wrap{max-width:1100px; margin:auto; padding:28px}
    header{margin-bottom:20px; text-align:center}
    h1{font-size:28px; margin:0}

    .layout{display:grid; grid-template-columns:1fr 340px; gap:24px}
    @media (max-width: 900px){ .layout{grid-template-columns:1fr} }

    .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:20px}
    .card{
      background:var(--card);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px; position:relative;
      border:2px dashed #efefef;
      display:flex; flex-direction:column; justify-content:space-between;
    }
    .ribbon{position:absolute; top:10px; right:10px; background:var(--pastel-1); padding:6px 10px; border-radius:999px; font-size:12px}
    .img{
      width:100%;
      aspect-ratio:3/4;
      height:auto;
      object-fit:cover;
      display:block;
      border-radius:16px;
      margin-bottom:10px;
      border:2px solid #f3eef1;
      background:#fff;
    }
    .title{font-size:18px; margin:6px 0 2px}
    .options{display:grid; gap:8px; margin:10px 0}
    .option{display:flex; align-items:center; gap:10px}
    .option input{accent-color: var(--accent)}
    button{appearance:none;border:0;border-radius:14px;padding:10px 14px;background:var(--accent); color:#073c33; font-weight:700; cursor:pointer}
    .muted{color:var(--muted)}

    .cart{position:sticky; top:14px; background:var(--card); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px;}
    .row{display:flex; align-items:center; justify-content:space-between; gap:10px}
    .divider{height:1px; background:#eee; margin:12px 0}
    .item{display:grid; grid-template-columns:1fr auto; gap:6px; padding:8px 0}
    .addons{font-size:13px; color:var(--muted)}
    .qty{display:flex; align-items:center; gap:6px}
    .qty input{width:56px; padding:6px 8px; border-radius:10px; border:1px solid #eee}
    .small{font-size:12px}

    .qrWrap{display:none; background:linear-gradient(135deg, var(--pastel-3), var(--pastel-2)); padding:12px; border-radius:16px; text-align:center}
    .qrWrap img{max-width:220px; width:100%; border-radius:12px; border:4px solid #fff; box-shadow:var(--shadow)}

  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Gen‚Äôs Matcha üçµ‚ú®</h1>
    </header>

    <div class="layout">
      <main>
        <p class="muted">Choose your drink, customise your matcha, and sip something super cute</p>
        <div class="grid" id="productGrid"></div>
      </main>

      <aside class="cart" id="cart">
        <h3 style="margin:0 0 8px">Your Cart</h3>
        <div id="cartItems"></div>
        <div class="divider"></div>
        <div class="row"><span>Subtotal</span><strong id="subtotal">$0.00</strong></div>
        <div class="row"><span>Total</span><strong id="total">$0.00</strong></div>
        <p class="small muted">Prices shown exclude delivery. Cart saves on this device.</p>
        <div class="divider"></div>
        <div class="row" style="gap:8px; flex-wrap:wrap">
          <button id="confirmBtn" style="background:var(--pastel-1)">Confirm stock</button>
          <button id="clearBtn" style="background:var(--pastel-2)">Clear cart</button>
        </div>
        <div class="qrWrap" id="qrWrap">
          <p style="margin:6px 0 10px"><b>PayNow</b> to complete your order</p>
          <img id="paynowQR" src="paynow-qr.png" alt="PayNow QR placeholder">
        </div>
      </aside>
    </div>
  </div>

  <script>
  const products = [
    {
      id: 'matcha-yuzu',
      title: 'Matcha Yuzu Tonic',
      img: 'img/matcha-yuzu.png',
      basePrice: 6.0,
      addons: [ { id: 'marukyu', label: 'Marukyu Isuzu', price: 1.0 } ]
    },
    {
      id: 'matcha-rasp',
      title: 'Matcha Raspberry Tonic',
      img: 'img/matcha-rasp.png',
      basePrice: 6.0,
      addons: [ { id: 'marukyu', label: 'Marukyu Isuzu', price: 1.0 } ]
    },
    {
      id: 'matcha-latte',
      title: 'Matcha Latte',
      img: 'img/matcha-latte.png',
      basePrice: 5.0,
      addons: [ { id: 'marukyu', label: 'Marukyu Isuzu', price: 1.0 }, { id: 'oat', label: 'Oatmilk', price: 0.5 } ]
    }
  ];

  const CART_KEY = 'whisk_matcha_cart_v1';
  const loadCart = () => JSON.parse(localStorage.getItem(CART_KEY) || '[]');
  const saveCart = (items) => localStorage.setItem(CART_KEY, JSON.stringify(items));
  let cart = loadCart();

  function money(n){ return '$' + (Math.round(n*100)/100).toFixed(2); }

  function itemPrice(p, chosen){
    const addSum = chosen.reduce((s,a)=> s + (a.price||0), 0);
    return p.basePrice + addSum;
  }

  function addToCart({productId, qty, chosen}){
    const p = products.find(x=>x.id===productId);
    if(!p) return;
    const key = productId + '::' + chosen.map(a=>a.id).sort().join('+');
    const title = p.title;
    const addonsLabel = chosen.length ? chosen.map(a=>a.label).join(', ') : 'No add-ons';
    const unitPrice = itemPrice(p, chosen);

    const existing = cart.find(x=>x.key===key);
    if(existing){ existing.qty += qty; }
    else {
      cart.push({ key, productId, title, addons: chosen, addonsLabel, unitPrice, qty });
    }
    saveCart(cart); renderCart();
  }

  function removeItem(key){ cart = cart.filter(x=>x.key!==key); saveCart(cart); renderCart(); }
  function setQty(key, q){ const it = cart.find(x=>x.key===key); if(it){ it.qty = Math.max(1, q|0); saveCart(cart); renderCart(); } }

  function totals(){
    const sub = cart.reduce((s,x)=> s + x.unitPrice * x.qty, 0);
    const total = sub;
    return { sub, total };
  }

  const grid = document.getElementById('productGrid');
  products.forEach(p=>{
    const card = document.createElement('article');
    card.className = 'card';
    card.innerHTML = `
      <img class="img" src="${p.img}" alt="${p.title}" loading="lazy"/>
      <div class="ribbon">${money(p.basePrice)}</div>
      <div class="title">${p.title}</div>
      <p class="muted small" style="margin:0">Choose add‚Äëons:</p>
      <div class="options"></div>
      <div class="row" style="margin-top:8px; gap:10px; align-items:center">
        <div class="qty small">Qty <input type="number" min="1" value="1"></div>
        <strong class="livePrice">${money(p.basePrice)}</strong>
        <button>Add to Cart</button>
      </div>
    `;

    const $opts = card.querySelector('.options');
    p.addons.forEach(a=>{
      const line = document.createElement('label');
      line.className = 'option';
      line.innerHTML = `<input type="checkbox" data-id="${a.id}" data-price="${a.price}"> <span>${a.label} (+${money(a.price)})</span>`;
      $opts.appendChild(line);
    });

    const qty = card.querySelector('input[type="number"]');
    const live = card.querySelector('.livePrice');

    function updateLive(){
      const chosen = [...card.querySelectorAll('input[type="checkbox"]:checked')].map(cb=>({ id: cb.dataset.id, label: cb.nextElementSibling.textContent.replace(/ \(.+\)/,''), price: parseFloat(cb.dataset.price) }));
      const price = itemPrice(p, chosen);
      live.textContent = money(price);
    }

    card.addEventListener('change', e=>{ if(e.target.type==='checkbox'){ updateLive(); } });
    updateLive();

    const btn = card.querySelector('button');
    btn.addEventListener('click', ()=>{
      const chosen = [...card.querySelectorAll('input[type="checkbox"]:checked')].map(cb=>({ id: cb.dataset.id, label: cb.nextElementSibling.textContent.replace(/ \(.+\)/,''), price: parseFloat(cb.dataset.price) }));
      addToCart({ productId: p.id, qty: parseInt(qty.value||'1',10), chosen });
      btn.textContent = 'Added ‚úì'; setTimeout(()=> btn.textContent='Add to Cart', 900);
    });

    grid.appendChild(card);
  });

  const $items = document.getElementById('cartItems');
  const $sub = document.getElementById('subtotal');
  const $tot = document.getElementById('total');

  function renderCart(){
    if(cart.length===0){
      $items.innerHTML = '<p class="muted">Your cart is empty.</p>';
      $sub.textContent = money(0); $tot.textContent = money(0);
      return;
    }
    $items.innerHTML = '';
    cart.forEach(it=>{
      const row = document.createElement('div');
      row.className = 'item';
      row.innerHTML = `
        <div>
          <div><strong>${it.title}</strong></div>
          <div class="addons">${it.addonsLabel}</div>
          <div class="small muted">${money(it.unitPrice)} each</div>
        </div>
        <div style="text-align:right">
          <div class="qty small">Qty <input type="number" min="1" value="${it.qty}"></div>
          <div style="margin-top:6px"><button title="Remove" style="background:var(--pastel-2)">Remove</button></div>
        </div>`;
      const qtyInput = row.querySelector('input');
      const rm = row.querySelector('button');
      qtyInput.addEventListener('change', e=> setQty(it.key, parseInt(e.target.value||'1',10)) );
      rm.addEventListener('click', ()=> removeItem(it.key) );
      $items.appendChild(row);
    });
    const t = totals();
    $sub.textContent = money(t.sub);
    $tot.textContent = money(t.total);
  }
  renderCart();

  const qrWrap = document.getElementById('qrWrap');
  const confirmBtn = document.getElementById('confirmBtn');
  const clearBtn = document.getElementById('clearBtn');

  confirmBtn.addEventListener('click', ()=>{
    if(cart.length===0){ alert('Cart is empty.'); return; }
    qrWrap.style.display = 'block';
    confirmBtn.textContent = 'Stock confirmed ‚úì';
  });
  clearBtn.addEventListener('click', ()=>{ cart = []; saveCart(cart); renderCart(); qrWrap.style.display='none'; confirmBtn.textContent='Confirm stock'; });

  </script>
</body>
</html>
